<script type="text/javascript">

	function history_submit_check(){
		
		if($('#owner_approach_approach_kind_id').children(':selected').val() == ''){
			alert('種別を選択してください');
			return false;
		}
	
		return true;
	}
</script>
		
<div class="navbar navbar-inverse" >
    <div class="title navbar-header biru-back-color-blue" >
		<% if @owner.attack_code %>
			受託見込み家主情報
		<% else %>
			家主履歴情報
		<% end %>
        <span class="user-header">
            <span class="user-name"><%= @biru_user.name %></span>
        </span>
    </div>
</div>

<div class="container">
	<div class='row'>
		<div class="col-sm-6">
			<div style="border-width:3px; border-style:solid; border-color:silver;">
				<div id="pop_map_canvas" style="height:400px;"></div>
			</div>
		</div>
		<div class="col-sm-6">
			<% if @owner.attack_code %>
				<%= render 'popup_owner_right_attack' %>
			<% else %>
				<%= render 'popup_owner_right_normal' %>
			<% end %>
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<div style="padding:30px 0px 0px 20px">
				<% if @owner.attack_code %>
					<%= render 'popup_owner_buildings_attack' %>
				<% else %>
					<%= render 'popup_owner_buildings_normal' %>
				<% end %>
			</div>
		</div>
	</div>

	
	<div class="row">
		<div class="col-sm-12">
			<div class="print-none">
				<%= simple_form_for :owner_approach, :url=>{:controller => :managements, :action => :owner_approach_regist}  do |f| %>
					<%= f.input :owner_id, :as => :hidden, :input_html => {:value => @owner.id } %>
					<%= f.input :biru_user_id, :as => :hidden, :input_html => {:value => @biru_user.id } %>
					<table>
						<tr>
							<td><div class="input-append date"><%= f.input :approach_date, label:'日付', placeholder: 'yyyy/mm/dd', :input_html => {:type => 'text', :style=>'width:100px;', :id=>'reg-date', :value=>Date.today.strftime('%Y/%m/%d')  } %></div></td>
							<td><%= f.input :approach_kind_id, label: '種別', collection: ApproachKind.where("kind_type = ?", if @owner.attack_code then 1 else 2 end ).order(:sequence), prompt: "--", :input_html => {:style=>'width:100px;margin-left:0px;padding-left:0px;vertical-align:middle' } %></td>
							<td><%= f.submit '登録', :class => 'btn btn-primary btn-sm', :style=>'margin-left:20px;', :onclick=>'return history_submit_check();' %></td>
						</tr>
					</table>
					<div style="margin-left:30px;margin-top:10px;">
						<%= f.text_area :content, label: false, :as => :text, placeholder: '履歴内容をいれてください',  :rows => 4, style: "width:100%;" ,:class =>"required", :required=>"required", :input_html => {  :style => 'margin-left:0px;padding-left:0px;'}  %>
					</div>
					<%#= f.input :approach_date, label: '日付', as: :datepicker %>
				<% end %>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<div style="padding-left:0px;padding-right:0px;margin-top:20px;">
				<%= grid(@owner_approaches) do |g|
						g.column name: '', :html=>{:style=>'width:50px;'} do |obj| link_to('削除',{:controller=>'managements', :action=>'owner_approach_delete', :id=>obj.id.to_s, :owner_id=>@owner.id.to_s}, :confirm => "削除します。よろしいですか？", :class=>'print-none') end
						g.column name: 'アプローチ日', :html=>{:style=>'width:100px;'} do |obj| obj.approach_date if obj.approach_date end
					g.column name: '種別', :html=>{:style=>'width:100px;'} do |obj| obj.approach_kind.name if obj.approach_kind end
					g.column name: '内容' do |obj| obj.content if obj.content end
					g.column name: '登録者', :html=>{:style=>'width:120px;'} do |obj| obj.biru_user.name if obj.biru_user end
					g.column name: '登録日', :html=>{:style=>'width:150px;'} do |obj| obj.created_at if obj.created_at end
				end
				%>
			</div>
		</div>
	</div>

</div>




<!-- モーダルダイアログ(ドキュメント管理) -->
<div class="modal fade" id="modal-owner-document" tabindex="-1" role="dialog" aria-labelledby="modal-owner-update-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h4 class="modal-title" id="myModalLabel">ドキュメント一覧</h4>
    </div>
  
		<script type="text/javascript">
		  function document_submit(){

		    if ($("#doc_file").val() === ''){
		      alert('ファイル名を指定してください');
		      return false;
		    }
		    
		    return true;
		  }
		</script>	  

		<%= form_tag({:action=>'popup_owner_documents_regist'}, {:multipart => true ,:id => 'popup_owner_documents_regist_form'}) do %>
		  <%= hidden_field_tag :owner_id, @owner.id %>
		  <div style="padding:10px;">
		    <table style="border-style: none;">
		      <tr>
		        <td><%= file_field_tag :doc_file %></td>
		        <td><%= submit_tag '登録',  :onclick=>('return document_submit();') %></td>
		      </tr>
		    </table>
		  </div>
		<% end%>

  <pre class="pre-scrollable" style="background-color:white">
    <table class="table table-striped table-bordered table-hover table-condensed" style="padding:0 0 0 0;margin:0 0 0 0 ;">
          <thead>
            <tr>
              <th>ファイル名</th>
              <th>登録者</th>
              <th>登録日</th>
            </tr>
          </thead>
          <tbody>
        <% @owner.documents.each do |doc| %>
          <tr>
            <td><%=link_to doc.file_name, popup_owner_documents_download_path(doc.id) %></td>
            <td><%= doc.biru_user.name if doc.biru_user %></td>
            <td><%= doc.updated_at %></td>
          </tr>
        <% end %>
          </tbody>
        </table>
  </pre>
  
  
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->



<script type="text/javascript">
$('#reg-date').datepicker({
	format: "yyyy/mm/dd",
	language: "ja",
	autoclose: true,
	orientation: "top auto"
});
</script>

